<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Socket.io</title>
    </head>
 
    <body>
        <h1>Communication avec socket.io !</h1>

        <section id="zone_chat">
                    
        </section>

        <form method="post">
            <input type="text" name="Username" id="Username" size="50" autofocus />
            <input type="password" name="password" id="password" size="50" autofocus />
            <input type="button" value="Confirmer" id="formulaire_connexion"/>
        </form>


        <p><input type="button" value="Chercher une partie" id="lookForGame" /></p>
        <button onclick="createCircle(), registercb()" onload="" >Create svg</button> 
        <div class="svg-container">
        <svg id="svg" width="1000" height="1000"  class="svg-content" ></svg>


        <section style="display:none" id="zone_jeu" >

            <button id="simulation"> Simulation onclick</button>

        </section>

        <script
  src="https://code.jquery.com/jquery-3.4.1.js"
  integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
  crossorigin="anonymous"></script>
        <script src="socket.io.js"></script>
        <script type="text/javascript" src="plateau.js"></script>
        <script type="text/javascript" src="score.js"></script>
        <script type="text/javascript" src="checkTurn.js"></script>
        <script type="text/javascript" src="jeu.js"></script>
        <script>
            // Connexion au port d'écoute
            var socket = io.connect('http://localhost:8080');

            //Lorsque quelqu'un se co, on envoie un texte dans #zone_Chat
            socket.on('nouveau_joueur', function(data) {
                $('#zone_chat').prepend('<p> Vous êtes connecté en tant que : <em>' + data.identifiant+ '</em></p>');
                console.log("La co dans index");
            });

            //Message recu lorsque quelqu'un se connecte
            socket.on('nouvel_adversaire', function(data) {
                $('#zone_chat').prepend('<p><em>' + data.identifiant+ '</em> vient de se connecter.</p>');
            });            

            socket.on("nouveauArticle", function(message){
                console.log("Un test");
                $('#zone_jeu').prepend('<p> Vous avez comme ip on emit: '+message+'</p>');
            })

            //Message recu lorsque quelqu'un se déconnecte
            socket.on('deconnexion', function(data){
                $('#zone_chat').prepend('<p><em>' + data+ '</em> vient de se déconnecter.</p>');
            });

            //Lors du clic sur la recherche de bouton on appele la fonction pour se mettre dans une room
            $('#lookForGame').click(function () {
                socket.emit('joinGame');
                var suppr = document.getElementById('lookForGame');
                suppr.parentNode.removeChild(suppr);
            });

            //lorsque le formulaire est remplis on l'envoie pour vérif
            $('#formulaire_connexion').click(function(){
                socket.emit('nouveau_joueur', {identifiant :$('#Username').val(), password:$('#password').val()});
            });

            socket.on('showGame',function(){
                var suppr = document.getElementById('zone_jeu');
                suppr.style.display="inline";
            });

            $('#simulation').click(function()
            {
                socket.emit('updateGame');
            });

            socket.on("message", function(id){
                $('#zone_jeu').prepend('<p> Le broadcast à la room : '+id+'</p>');
            })

            socket.on('modificationJeu',function(id){
                console.log("je m'update bien c'est cool");
                $('#zone_jeu').prepend('Normalement sa up');
            });

            $('#svg').click(function()
            {
                //Les coordonnées d'arrivé du pion
                console.log("les coordonnées du pion à la fin: ", getFinalX() , getFinalY());
                //les coordonnées de départ à faire *70+35
                console.log("les coordonnées du pion au début: ", UntrucAuPifx(), UntrucAuPify());
                let xDepart = UntrucAuPifx() * 70 + 35;
                let yDepart = UntrucAuPify() * 70 + 35;
                //console.log("le plateau ", gameBoardShow());
                console.log("le pion qu'on doit modifier: ", xDepart, yDepart)

                socket.emit('updateGame', xDepart, yDepart, getFinalX(),getFinalY());
            });

            socket.on('refreshGame', function(id,DepartX, DepartY, getX, getY){
                console.log("Est ce que je peux m'envoyer des merde de nul part: ", DepartX, DepartY);
                console.log("Est ce que je peux m'envoyer des merde de nul part: ", getX, getY);
                for(let i=0; i<30; i++ )
                {
                    if(document.getElementsByTagName("circle")[i].cx.baseVal.value == DepartX && document.getElementsByTagName("circle")[i].cy.baseVal.value == DepartY)
                    {
                        console.log("cool on l'a");
                        let ModifiedPion = document.getElementsByTagName("circle")[i];
                        console.log("Le pion à modifier: " ,ModifiedPion);
                        ModifiedPion.cx.baseVal.value = getX;
                        ModifiedPion.cy.baseVal.value = getY;
                    }
                }
                //let pionModifier = document.getElementsByTagName("circle")[8].cx;
                //30
                //let pionModifier = document.getElementsByTagName("circle")[0].cx.baseVal.value= DepartX;
                //console.log("Le pion à modifier: ", pionModifier);
                //console.log("Le refresh game est censé se faire: ", getSelectedElement());
                //console.log("les coordonnées du pion à la fin: ", getX() , getY());

                //deplacerPion(getSelectedElement(), 5, 5);
            })

        </script>
    </body>
</html>

<!-- mettre les identifiant/passwords dans le petit-nouveau si ils correspondent à des trucs alors connexion-->

<!-- Chopper événement jeu.js ligne 76-->