<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, user-scalable=no">
        <title>Checkers</title>
            <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
        <script src="/js/script.js"></script>
        <script src=”/socket.io/socket.io.js”></script>
        <link href="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.css" rel="stylesheet" type="text/css">
        <link href="../Documents/css/bootstrap-4.3.1.css" rel="stylesheet" type="text/css">
        <link href="../Documents/jQueryAssets/jquery.ui.core.min.css" rel="stylesheet" type="text/css">
        <link href="../Documents/jQueryAssets/jquery.ui.theme.min.css" rel="stylesheet" type="text/css">
        <link href="../Documents/jQueryAssets/jquery.ui.accordion.min.css" rel="stylesheet" type="text/css">
        <link href="../Documents/jQueryAssets/jquery.ui.button.min.css" rel="stylesheet" type="text/css">
        <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.js"></script>
        <script src="../Documents/jQueryAssets/jquery-1.11.1.min.js"></script>
        <script src="../Documents/jQueryAssets/jquery.ui-1.10.4.accordion.min.js"></script>
        <script src="https://kit.fontawesome.com/078c236eda.js" crossorigin="anonymous"></script>
        <script src="../Documents/jQueryAssets/jquery.ui-1.10.4.button.min.js"></script>
    </head>
 
    <body>

<div id="home" data-role="page">
    <div class="head" id="header" data-role="header" data-position="fixed"><span style="color: #709DCB"></span>
        <h1 class="ui-title text-center" style="margin-top: 20px;"><strong>Mon compte</strong></span></h1>
    </div>

    <div data-role="content" data-theme="a">
        <form>
            <p>Pseudo <input type="text" class="username" name="Username" id="Username" size="50" autofocus /></p>
            <p>Password <input type="password" class="password" name="password" id="password" size="50" autofocus/></p>
            <input type="button" onclick="ConnexionUser()" value="Login"/>
        </form>

        <p>Vous n'avez pas de compte ? <a href="#creerCompte">Cliquer ici pour créer un compte.</a> </p>
    </div>
    <div data-role="footer">
        <h4 class="ui-title text-center"><a href="#login" data-role="button" class="fas fa-user-circle" style="font-size: x-large; margin-left: 200px; color: chocolate;"></a>
            <a href="#" data-role="button" class="fas fa-cog style=" style="font-size: x-large; margin-left: 20px; color: #DABD49;"></a>
        </h4>
    </div>
</div>


<div id="creerCompte" data-role="page">
    <div class="head" data-role="header" data-position="fixed"><span style="color: #709DCB"></span>
        <h1 class="ui-title text-center" style="margin-top: 20px;"><strong>Créer un compte</strong></span></h1>
    </div>

    <div data-role="content" data-theme="a">
        <p>Création du compte</p>
        <section id="zone_chat">
                    
        </section>
        <form method="post">
            <p>Pseudo <input type="text" class="username" name="Username" id="Username" size="50" autofocus /></p>
            <p>Password <input type="password" class="password" name="password" id="password" size="50" autofocus /></p>
            <input type="button" onclick="creerUser()" value="Créer un compte" id="formulaire_connexion"/>
        </form>

        <p><a href="/">Cliquer ici pour revenir en arrière.</a> </p>
    </div>
</div>

<div id="login" onload="getUser()" data-role="page" data-theme="a">

    <div class="head" data-role="header"><span style="color: #709DCB"></span>
        <div class="row">
            <div data-role="collapsible-set" class="col-4">
                <div data-role="collapsible" data-content-theme="a">
                    <h3><i class="fas fa-bars" style = "font-size: 24px;"></i></h3>
                    <div class="margesinternes">
                        <p>Jouer</p>
                        <p>Apprendre</p>
                        <p>Membres</p>
                    </div>
                </div>
            </div>
            <div class="col-4 offset-0"><img src="checkers.png" alt="logo" width="74" height="70" class="logo"/></div>
        </div>
    </div>

    <p>Hello <span class="username"></span>! </p>
    <p><a href="/logout">Se déconnecter</a> </p>
    <form>
        <p>Ajouter un score a la partie : <input type="text" class="score" /> </p>
        <input type="button" onclick="addParties()" value="Ajouter à la liste une Partie "/>
    </form>

    <table border="1px" width="100%" id="itemtable">
        <tr>
            <th>Id</th>
            <th>Score</th>
            <th>Post Time</th>
        </tr>
    </table>
    <div data-role="content" data-theme="a">
        <svg width="300px" viewBox="0 0 700 600" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <pattern id="cell" patternUnits="userSpaceOnUse" width="200" height="200">
                </pattern>
            </defs>
            <svg width="100%" height="100%">
                <pattern  id="pattern-checkers" x="0" y="0" width="20%" height="20%" patternUnits="userSpaceOnUse">
                    <rect id ="rectangle1" fill="#CC5822" class="checker" x="0" width="10%" height="10%" y="0">
                    </rect>
                    <rect id ="rectangle1" fill="#CC5822" class="checker" x="10%" width="10%" height="10%" y="10%"/>
                </pattern>
                <rect stroke-linecap="square" stroke="black" stroke-width="15" x="0" y="0" width="100%" height="100%" fill="url(#pattern-checkers)" />
                <circle id="cercleQuiBouge" cx="100" cy="570" r="28" stroke="orange" stroke-width="2"  fill="black">
                    <animate attributeName="cy" attributeType="XML" from="570" to="510" begin="cercleQuiBouge.click" dur="2s" fill="freeze" />
                    <animate attributeName="cx" attributeType="XML" from="100" to="180" begin="cercleQuiBouge.click" dur="2s" fill="freeze" />
                </circle>
                <circle id="cercleQuiBouge2" cx="25" cy="510" r="28" stroke="orange" stroke-width="2"  fill="black">
                    <animate attributeName="cy" attributeType="XML" from="510" to="450" begin="rectangle1.click" dur="2s" fill="freeze" />
                    <animate attributeName="cx" attributeType="XML" from="25" to="110" begin="rectangle1.click" dur="2s" fill="freeze" />

                </circle>
            </svg>
        </svg>
        <a href="#jeu" data-role="button">Jouer</a>
        <p>&nbsp;</p>
    </div>
    <div data-role="footer">
        <h4 class="ui-title text-center"><a href="#login" data-role="button" class="fas fa-user-circle" style="font-size: x-large; margin-left: 200px; color: #DABD49;"></a>
            <a href="#" data-role="button" class="fas fa-cog style=" style="font-size: x-large; margin-left: 20px; color: #DABD49;"></a>
        </h4>
    </div>
</div>


<div id="jeu" data-role="page" >
    <div class="head" data-role="header" data-position="fixed"><span style="color: #709DCB"></span>
        <h1 class="ui-title text-center" style="margin-top: 20px;"><strong> Partie </strong></span></h1>
    </div>

    <div data-role="content" data-theme="a">

    <section id="zone_chat">
                    
    </section>

    <p><input type="button" value="Chercher une partie" id="lookForGame" /></p>
    <button onclick="createRect(), registercb()" onload="" >Create svg</button> 
    <div class="svg-container">
    <svg id="svg" width="1000" height="1000"  class="svg-content" ></svg>
    </div>
    <section style="display:none" id="zone_jeu" >
      
        <button id="simulation" onclick='createCircle()'> Simulation onclick</button>

    </section>

    <script
src="https://code.jquery.com/jquery-3.4.1.js"
integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
crossorigin="anonymous"></script>
    <script src="socket.io.js"></script>
    <script type="text/javascript" src="plateau.js"></script>
    <script type="text/javascript" src="score.js"></script>
    <script type="text/javascript" src="checkTurn.js"></script>
    <script type="text/javascript" src="jeu.js"></script>
    <script>
        // Connexion au port d'écoute
        var socket = io.connect('http://localhost:8080', {
            'reconnection': true,
            'reconnectionDelay':500,
            'reconnectionAttempts': 10,
            'forceNew': false
        });
        //liste des sockets
        var allClients = [];
        //liste des rooms avec les sockets à l'intérieur?
        var allRooms = [];
        // Si une personne se reconnecte avec les mêmes identifiants alors on lui donne la même id de socket, du coup
        //Il faudra faire des vérifs de sockets à droite à gauche
        //en cas de deconnexion d'une personne on check toutes les rooms si il est présent:
        // 1) On attend un certains moment puis on dit que l'autre à gagné
        // 2) On dit à l'autre qu'il à gagner par forfait
        //Si il est pas là: Baaaah c'est cool c'est plus mon problème
        //Lorsque quelqu'un se co, on envoie un texte dans #zone_Chat
        socket.on('nouveau_joueur', function(data) {
            $('#zone_chat').prepend('<p> Vous êtes connecté en tant que : <em>' + data.identifiant+ '</em></p>');
        });
        socket.on("nouveau_Compte", function(data, message){
            $('#zone_chat').prepend('<p>' +message+' : <em>' + data.identifiant+ '</em></p>');
        });
        //Message recu lorsque quelqu'un se connecte
        socket.on('nouvel_adversaire', function(data) {
            $('#zone_chat').prepend('<p><em>' + data.identifiant+ '</em> vient de se connecter.</p>');
        });            
        socket.on("nouveauArticle", function(message){
            $('#zone_jeu').prepend('<p> Vous avez comme ip on emit: '+message+'</p>');
        })
        //Message recu lorsque quelqu'un se déconnecte
        socket.on('deconnexion', function(data){
            $('#zone_chat').prepend('<p><em>' + data+ '</em> vient de se déconnecter.</p>');
        });
        //Lors du clic sur la recherche de bouton on appele la fonction pour se mettre dans une room
        $('#lookForGame').click(function () {
            socket.emit('joinGame');
            var suppr = document.getElementById('lookForGame');
            suppr.parentNode.removeChild(suppr);
        });
        //lorsque le formulaire est remplis on l'envoie pour vérif
        $('#formulaire_connexion').click(function(){
            socket.emit('nouveau_joueur', {identifiant :$('#Username').val(), password:$('#password').val()});
        });
        socket.on('showGame',function(){
            var suppr = document.getElementById('zone_jeu');
            suppr.style.display="inline";
            
        });
        $('#simulation').click(function()
        {
            socket.emit('updateGame');
        });
        socket.on("message", function(id){
            $('#zone_jeu').prepend('<p> Le broadcast à la room : '+id+'</p>');
        })
        socket.on('modificationJeu',function(id){
            $('#zone_jeu').prepend('Normalement sa up');
            createCircle();
            registercb();
        });
        $('#svg').click(function()
        {
            let CenteredX = (getFinalX() /70); let CenteredY = (getFinalY() /70);
            CenteredX = Math.floor(CenteredX); CenteredY = Math.floor(CenteredY);
            CenteredX = CenteredX *70 +35; CenteredY = CenteredY *70 +35;
            let xDepart = UntrucAuPifx() * 70 + 35; let yDepart = UntrucAuPify() * 70 + 35;
            socket.emit('updateGame', xDepart, yDepart,CenteredX,CenteredY);
        });
        socket.on('refreshGame', function(id,DepartX, DepartY, getX, getY){
            for(let i=0; i<30; i++ )
            {
                if(document.getElementsByTagName("circle")[i].cx.baseVal.value == DepartX && document.getElementsByTagName("circle")[i].cy.baseVal.value == DepartY)
                {
                    let ModifiedPion = document.getElementsByTagName("circle")[i];
                    ModifiedPion.cx.baseVal.value = getX;
                    ModifiedPion.cy.baseVal.value = getY;
                }
            }
        })
    </script>
    <style>
    .svg-container {
display: inline-block;
position: relative;
width: 100%;
padding-bottom: 100%;
vertical-align: middle;
overflow: hidden;
}
.svg-content {
display: inline-block;
position: absolute;
top: 0;
left: 0;
}</style>
    </div>
    <div data-role="footer">
        <h4 class="ui-title text-center"><a href="#pageUser" data-role="button" class="fas fa-user-circle" style="font-size: x-large; margin-left: 200px; color: chocolate;"></a>
            <a href="#pageSetting" data-role="button" class="fas fa-cog style=" style="font-size: x-large; margin-left: 20px; color: #DABD49;"></a>
        </h4>
    </div>
</div>
    </body>
</html>

<!-- mettre les identifiant/passwords dans le petit-nouveau si ils correspondent à des trucs alors connexion-->

<!-- Chopper événement jeu.js ligne 76-->