<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Socket.io</title>
    </head>
 
    <body>
        <h1>Communication avec socket.io !</h1>

        <section id="zone_chat">
                    
        </section>

        <form method="post">
            <input type="text" name="Username" id="Username" size="50" autofocus />
            <input type="password" name="password" id="password" size="50" autofocus />
            <input type="button" value="Confirmer" id="formulaire_connexion"/>
        </form>


        <p><input type="button" value="Chercher une partie" id="lookForGame" /></p>
        <button onclick="createRect(), registercb()" onload="" >Create svg</button> 
        <div class="svg-container">
        <svg id="svg" width="1000" height="1000"  class="svg-content" ></svg>

        <section style="display:none" id="zone_jeu" >
          
            <button id="simulation" onclick='createRect()'> Simulation onclick</button>
            <button id="surrender"> Se rendre </button>
        </section>

        <script
  src="https://code.jquery.com/jquery-3.4.1.js"
  integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
  crossorigin="anonymous"></script>
        <script src="socket.io.js"></script>
        <script type="text/javascript" src="plateau.js"></script>
        <script type="text/javascript" src="score.js"></script>
        <script type="text/javascript" src="checkTurn.js"></script>
        
        <script type="text/javascript" src="jeu.js"></script>
        <script type="text/javascript" src="queenProcess.js"></script>
        <script>
            // Connexion au port d'écoute
            var socket = io.connect('http://localhost:8080', {
                'reconnection': true,
                'reconnectionDelay':500,
                'reconnectionAttempts': 10,
                'forceNew': false
            });

            //liste des sockets
            var allClients = [];

            //liste des rooms avec les sockets à l'intérieur?
            var allRooms = [];
            // Si une personne se reconnecte avec les mêmes identifiants alors on lui donne la même id de socket, du coup
            //Il faudra faire des vérifs de sockets à droite à gauche

            //Lorsque quelqu'un se co, on envoie un texte dans #zone_Chat
            socket.on('nouveau_joueur', function(data) {
                $('#zone_chat').prepend('<p> Vous êtes connecté en tant que : <em>' + data.identifiant+ '</em></p>');
            });

            socket.on("nouveau_Compte", function(data, message){
                $('#zone_chat').prepend('<p>' +message+' : <em>' + data.identifiant+ '</em></p>');
            });

            //Message recu lorsque quelqu'un se connecte
            socket.on('nouvel_adversaire', function(data) {
                $('#zone_chat').prepend('<p><em>' + data.identifiant+ '</em> vient de se connecter.</p>');
            });            

            socket.on("nouveauArticle", function(message){
                $('#zone_jeu').prepend('<p> Vous avez comme ip on emit: '+message+'</p>');
            })

            //Message recu lorsque quelqu'un se déconnecte
            socket.on('deconnexion', function(data){
                $('#zone_chat').prepend('<p><em>' + data+ '</em> vient de se déconnecter.</p>');
            });

            //Lors du clic sur la recherche de bouton on appele la fonction pour se mettre dans une room
            $('#lookForGame').click(function () {
                socket.emit('joinGame');
                var suppr = document.getElementById('lookForGame');
                suppr.style.display="none";
            });

            //lorsque le formulaire est remplis on l'envoie pour vérif
            $('#formulaire_connexion').click(function(){
                socket.emit('nouveau_joueur', {identifiant :$('#Username').val(), password:$('#password').val()});
            });

            socket.on('showGame',function(){
                var suppr = document.getElementById('zone_jeu');
                suppr.style.display="inline";
                
            });

            socket.on('gameFinished',function(){
                var suppr = document.getElementById('zone_jeu');
                suppr.style.display="none";
                suppr = document.getElementById('lookForGame');
                suppr.style.display="inline";
                suppr = document.getElementById("svg");
                suppr.style.display="none";
            })

            $('#simulation').click(function()
            {
                socket.emit('updateGame');
                test = socket.emit('getList');
                
            });

            socket.on("message", function(id){
                $('#zone_jeu').prepend('<p> le message qui à était envoyé '+id+'</p>');
            })

            socket.on("messageGagnant", function(id){
                alert(id);
            })

            socket.on('modificationJeu',function(id){
                $('#zone_jeu').prepend('Normalement sa up');
                createCircle();
                registercb();
            });


            $('#svg').click(function()
            {
                console.log(getJoueurUn().pionStart.cy);
                pionStartX = getJoueurUn().pionStart.cx; pionStartY = getJoueurUn().pionStart.cy
                pionEndX = getJoueurUn().pionEnd.cx; pionEndY = getJoueurUn().pionEnd.cy
               
                    
                mangeX = getJoueurUn().mange.cx; mangeY = getJoueurUn().mange.cy
               
                console.log('X :'+pionEndX+' Y:'+pionEndY)
                console.log('Mange X :'+mangeX+' Mange Y:'+mangeY)
                boardGame = getJoueurUn().board
                makeQueen = getJoueurUn().makeQueen
                
                
                changeQueenClass = getJoueurUn().changeColorQueen
                console.log('QUEEEEEEEEEEEEN')
                
                socket.emit('updateGame', pionStartX, pionStartY,pionEndX,pionEndY, mangeX, mangeY, getBoard(), makeQueen, changeQueenClass);
            });

            $('#surrender').click(function()
            {
                socket.emit('Surrender');
            });

           

            socket.on('refreshGame', function(id,pionStartX, pionStartY,pionEndX,pionEndY, mangeX, mangeY, board, makeQueen, changeQueenClass){
                console.log('X :'+pionEndX+' Y:'+pionEndY)
                console.log('Mange X :'+mangeX+' Mange Y:'+mangeY)
                gameBoard = getBoard();
               
                for(let i=0; i<30; i++ )
                {
                    if(document.getElementsByTagName("circle")[i].cx.baseVal.value == pionStartX && document.getElementsByTagName("circle")[i].cy.baseVal.value ==  pionStartY)
                    {   
                        let ModifiedPion = document.getElementsByTagName("circle")[i];
                        pionStartYint = Math.floor(parseInt(pionStartY)/70)
                        pionStartXint = Math.floor(parseInt(pionStartX)/70)
                        pionEndXint = Math.floor(parseInt(pionEndX)/70)
                        pionEndYint = Math.floor(parseInt(pionEndY)/70)
                       
                        
                        gameBoard[pionEndYint][pionEndXint] = gameBoard[pionStartYint][pionStartXint]
                        gameBoard[pionStartYint][pionStartXint] = r[0]
                        ModifiedPion.cx.baseVal.value = pionEndX;
                        ModifiedPion.cy.baseVal.value = pionEndY;
                        // console.log('JOUEUR TURN')
                        // console.log(getJoueurUn())
                        // turn = getTurn()
                        // updateTurn(turn)
                        // console.log('QUEEEEEEEEEEEEN')
                        // console.log(getTurn)
                        
                        if(makeQueen == true)
                        {
                            ModifiedPion.setAttribute("class", changeQueenClass);
                            ModifiedPion.setAttribute("stroke", 'black');
                            ModifiedPion.setAttribute("stroke-width", 10);
                        }
                    }    
                    if(document.getElementsByTagName("circle")[i].cx.baseVal.value == mangeX && document.getElementsByTagName("circle")[i].cy.baseVal.value == mangeY)
                    {   
                        
                        console.log('OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO')
                        console.log(document.getElementsByTagName("circle")[i])
                        mangeYint = Math.floor(parseInt(mangeY)/70)
                        mangeXint = Math.floor(parseInt(mangeX)/70)
                        gameBoard[mangeYint][mangeXint] = r[0]
                        let RemovePion = document.getElementsByTagName("circle")[i];
                        RemovePion.style.display = 'none';
                       

                    }

                }
            })

            // // $('#svg').click(function()
            // // {
            // //     console.log(getJoueurUn().pionStart);
            // //     pionStop =getJoueurUn().pionEnd
            // //     if(pionStop !=null){
            // //     pionStopCx = getJoueurUn().pionEnd.cx.baseVal.value;
            // //     pionStopCy = getJoueurUn().pionEnd.cy.baseVal.value;
            // // }else{
            // //     pionStopCx = null
            // //     pionStopCy = null;
            // // }
            
            // //     console.log(pionStopCx, pionStopCy)
            // //     socket.emit('updateGame', pionStopCx, pionStopCy);
            // // });

            // // socket.on('refreshGame', function(id,pionStopCx, pionStopCy){
            // //     console.log(getJoueurUn())
            // //     console.log('PION RECUP---------------------------------')
            // //     console.log('Cx: '+pionStopCx+' Cy: '+pionStopCy)
            // //     if(pionStopCx!=null && pionStopCy !=null){

            // //     }
            // // }
            // )

            //Tout les 100 secondes on vérifie l'état de la room de la personne
            setInterval(function() { ragequit();}, 100000);

            function ragequit()
            {
                console.log("Je suis dans le ragequit");
                socket.emit("checkRagequit");
            }

        </script>
    </body>
</html>

<!-- mettre les identifiant/passwords dans le petit-nouveau si ils correspondent à des trucs alors connexion-->

<!-- Chopper événement jeu.js ligne 76-->
