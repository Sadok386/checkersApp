<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Socket.io</title>
    </head>
 
    <body >

        <p><input type="button" value="Chercher une partie" id="poke" /></p>
        <button onclick="createCircle(), registercb()" onload="" >Create svg</button> 
        <svg id="svg" width="800" height="800"></svg>
        <script
  src="https://code.jquery.com/jquery-3.4.1.js"
  integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
  crossorigin="anonymous"></script>
        <script>
            var svgns = "http://www.w3.org/2000/svg";  

function createCircle()
{
    var svg = document.getElementById('svg');
    var shape = document.createElementNS(svgns, "circle");
    var rectangle = document.createElementNS(svgns, "rectangle")


    var str = "";
    for (var i = 0; i < 10; i++) {
        for (var j = 0; j < 10; j++){

            

            var line1 = document.createElementNS(svgns, "rect")
            line1.setAttributeNS(null, "x", j*80)
            line1.setAttributeNS(null, "y", i*80)
            line1.setAttributeNS(null, 'height', '80');
            line1.setAttributeNS(null, 'width', '80');
            line1.setAttributeNS(null, 'fill', (i+j)%2 == 0 ? 'blue' : 'orange');
            line1.setAttribute("class", "playableCell");
            svg.appendChild(line1);
        
        }
    }
    createCircle2();
} 
function createCircle2()
{
    for (var i = 0; i < 10; i++) {
    for (var j = 0; j < 10; j++){

     if((i+j)%2 == 0 && (i < 3 || i > 6) ){
        var circles = document.createElementNS(svgns, "circle")
            
            circles.setAttribute("cx",j*80+40);
            if(i < 3){
            circles.setAttributeNS(null, 'fill','green');
            circles.setAttribute("cy",i*80+40);
            circles.setAttribute("class", "vert");
        }
            if(i > 6){
            circles.setAttributeNS(null, 'fill','pink');
            circles.setAttribute("cy",i*80+40);
            circles.setAttribute("class", "rose");
            }
            circles.setAttribute("r",20);
            

        }
        svg.appendChild(circles);
    }
}
}
var selectedElement = null;
var prevElement = null;
var currentX = 0;
var currentY = 0;

  

   function registercb(){
      
      var startPositionCx = 0
      var startPositionCy = 0
      var stopPositionCx = 0
      var stopPositionCy = 0
      var a = document.getElementById("svg");

      boardArray = Array.prototype.slice.call(a.childNodes);
            p = boardArray.slice(100,130)
            var gameBoard = [
            [p[0], 0, p[1], 0, p[2], 0, p[3], 0, p[4], 0],
            [0, p[5], 0, p[6], 0, p[7], 0, p[8], 0 ,p[9]],
            [p[10], 0, p[11], 0, p[12], 0, p[13], 0, p[14], 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, p[15], 0, p[16], 0, p[17], 0, p[18], 0, p[19]],
            [p[20], 0, p[21], 0, p[22], 0, p[23], 0, p[24], 0],
            [0, p[25], 0, p[26], 0, p[27], 0, p[28], 0, p[29]]
        
        ]; console.log(gameBoard)
            
        $("#svg > circle").mousedown(function (e) {

          
       
//get the inner DOM of alpha.svg

            // boardArraySliced.forEach((item, index) => {
            // console.log(index);
            
            // })
            
          console.log("ici")
            // save the original values
            currentX = e.clientX;
            currentY = e.clientY;
            selectedElement = e.target;
            startPositionCx = Math.floor(parseInt(selectedElement.cx.baseVal.value)/80)
            startPositionCy = Math.floor(parseInt(selectedElement.cy.baseVal.value)/80)
            startPositionCxPixel =  parseInt(selectedElement.getAttribute("cx"))
            startPositionCyPixel =   parseInt(selectedElement.getAttribute("cy"))
        }).mousemove(function (e) {    
            // if there is an active element, move it around            
            if (selectedElement) {
                var dx = parseInt(selectedElement.getAttribute("cx")) + e.clientX - currentX;
                var dy = parseInt(selectedElement.getAttribute("cy")) + e.clientY - currentY;
                currentX = e.clientX;
                currentY = e.clientY;
                selectedElement.setAttribute("cx", dx);
                selectedElement.setAttribute("cy", dy);
               
            }
        }).mouseup(function (e) {
            stopPositionCx = Math.floor(parseInt(selectedElement.cx.baseVal.value)/80)
            stopPositionCy = Math.floor(parseInt(selectedElement.cy.baseVal.value)/80)
            couleurPion = selectedElement.className.baseVal;
            stopPositionCxPixel =  parseInt(selectedElement.getAttribute("cx"))
            stopPositionCyPixel =   parseInt(selectedElement.getAttribute("cy"))
            console.log('startPositionCx : '+startPositionCx, 'startPositionCy : '+startPositionCy)
            // deactivate element after setting it into its new location
            
            console.log(gameBoard)
            if(couleurPion =='rose')
                if(startPositionCx+1 == stopPositionCx && startPositionCy-1 == stopPositionCy 
                || startPositionCx-1 == stopPositionCx && startPositionCy-1 == stopPositionCy){
                    
                   
                    if(gameBoard[startPositionCy-1][startPositionCx+1] !=0|| gameBoard[startPositionCy-1][startPositionCx-1] != 0){

                        gameBoard[stopPositionCy-1][stopPositionCx+1]=gameBoard[startPositionCy][startPositionCx]
                        gameBoard[startPositionCy][startPositionCx]= 0
                        console.log('---------------------------')
                        console.log(gameBoard[startPositionCy-1][startPositionCx+1])
                    selectedElement.setAttribute("cy", (startPositionCy-2)*80+40);
                    console.log('---------------------------')
                    console.dir(gameBoard[startPositionCy-1][startPositionCx-1])
                    gameBoard[stopPositionCy][stopPositionCx].style.display = 'none';
                    if(startPositionCx-1 == stopPositionCx && startPositionCy-1 == stopPositionCy){
                        selectedElement.setAttribute("cx", (startPositionCx-2)*80+40);
                    }else{
                        selectedElement.setAttribute("cx", (startPositionCx+2)*80+40);
                    }
                        
                    }else{
                        gameBoard[stopPositionCy][stopPositionCx]=gameBoard[startPositionCy][startPositionCx]
                        gameBoard[startPositionCy][startPositionCx]= 0
                    }
                    
             
                    
                    console.log("Pos+1 : "+ gameBoard[startPositionCy+1][startPositionCx+1])

                    console.log("Mouvement autoriser");
                }
                else if(startPositionCx == stopPositionCx && startPositionCy == stopPositionCy){
                    console.log("Veuillez bouger votre pion:");
                }else{
                    console.log("Mouvement interdit");
                    selectedElement.setAttribute("cx", startPositionCxPixel);
                    selectedElement.setAttribute("cy", startPositionCyPixel);
                }
            else{
                if(startPositionCx-1 == stopPositionCx && startPositionCy+1 == stopPositionCy 
                || startPositionCx+1 == stopPositionCx && startPositionCy+1 == stopPositionCy){
                    
                    if(gameBoard[startPositionCy+1][startPositionCx-1] !=0 || gameBoard[startPositionCy+1][startPositionCx+1]){

                        gameBoard[stopPositionCy-1][stopPositionCx+1]=gameBoard[startPositionCy][startPositionCx]
                        gameBoard[startPositionCy][startPositionCx]= 0

                        console.log( gameBoard[stopPositionCy][stopPositionCx])
                        selectedElement.setAttribute("cy", (startPositionCy+2)*80+40);
                        console.log('---------------------------')
                        console.log(gameBoard[stopPositionCy+1][stopPositionCx-1])
                        gameBoard[stopPositionCy][stopPositionCx].style.display = 'none';
                        gameBoard[stopPositionCy][stopPositionCx] = 0;
                        if(startPositionCx-1 == stopPositionCx && startPositionCy-1 == stopPositionCy){
                        selectedElement.setAttribute("cx", (startPositionCx-2)*80+40);
                        }else{
                        selectedElement.setAttribute("cx", (startPositionCx+2)*80+40);
                        }

                        }else{
                        gameBoard[stopPositionCy][stopPositionCx]=gameBoard[startPositionCy][startPositionCx]
                        gameBoard[startPositionCy][startPositionCx]= 0
                        }

                    console.log("Mouvement autoriser");
                    
                }
                else if(startPositionCx == stopPositionCx && startPositionCy == stopPositionCy){
                    console.log("Veuillez bouger votre pion");
                }else{
                    selectedElement.setAttribute("cx", startPositionCxPixel);
                    selectedElement.setAttribute("cy", startPositionCyPixel);
                    console.log("Mouvement interdit");
                }

            }
            
            //if(startPositionCx+1 == stopPositionCx && startPositionCy-1 == stopPositionCy)
            
            console.log('stopPositionCx : '+stopPositionCx, 'stopPositionCy : '+stopPositionCy)
            console.log();
            selectedElement = null;  
           
        });
    };
    
    function log() {
        if (window.console && window.console.log)
            window.console.log('[XXX] ' + Array.prototype.join.call(arguments, ' '));
    };
    

 
        </script>
    </body>
</html>

<!-- mettre les identifiant/passwords dans le petit-nouveau si ils correspondent à des trucs alors connexion-->